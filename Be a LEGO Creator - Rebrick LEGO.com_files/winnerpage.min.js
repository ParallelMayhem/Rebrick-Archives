!function(a){"use strict";function b(a,b){for(var c=0;c<a.length;c++)if(a[c]===b.Id)return!0;return!1}function c(a,b){var c=document.createElement("div");c.id=a.Id,y=$(".EntryInWinner").html(),$(c).html(y),$(c).find(".userName").text(a.DisplayName);var d=document.createElement("img");d.src=a.Images[0].ImageUrls.FixedHeightThumbnail.Url,$(c).find(".entryImage").append(d),$(c).find(".entryTitle").text(a.Title);var e;e=null!==i&&i.Authenticated===!0&&i.PublicUserId.toLowerCase()===a.UserId.toLowerCase().replace(/\-/g,"")?$(".winnerPage").attr("data-currentuserredirect"):$(".winnerPage").attr("data-otheruserredirecturl")+"?puid="+a.UserId,$(c).find(".redirectOthers").attr("href",e);var f=v.indexOf(encodeURI(a.SystemTags[0]).replace("%7B","%7b").replace("%7D","%7d"));f>-1&&($(c).find(".contestName").text(decodeURI(w[f].replace(/\+/g," "))),$(c).find(".contestUrl").attr("href",decodeURIComponent(x[f])));var g="";"undefined"!=typeof z?(g=z+a.SystemTags[0]+"&a_id="+a.Id+"&sortEntry="+A,$(c).find(".entryUrl").attr("href",g),$(c).find(".Entries").attr("href",g),$(c).find(".entryTitle").attr("href",g)):($(".Entries").css("cursor","inherit"),$(".Entries").click(function(a){a.preventDefault()})),B.indexOf(a.Id.toLowerCase())>-1?($(c).find(".likeMe").html('<span class="icons likeMe" id="#btnLike-'+a.Id+'" style="background-position:-103px -60px; background-color:#00243F;"></span>'),$(c).find(".likeMe").attr("onclick","")):$(c).find(".likeMe").attr("onclick","LEGO.Site.Rebrick.API.likeContestEntry('"+a.Id+"','"+n+"','"+o+"',"+j+", 'true', this, '"+p+"')"),b?(F+=1,$("#winnerEntryLoadMore").hide()):(c.style.display="none",$("#winnerEntryLoadMore").show()),$("#winnerPageEntry").append(c)}function d(a){var b=$("#globalBody").attr("data-serviceurl")+$("#globalBody").attr("data-serviceversion")+$("#globalBody").attr("data-methodname");b+="/"+a,b+="?includePremoderated=false",LEGO.Site.Rebrick.API.executeServiceRequest(b,"get",!1,"application/json; charset=utf-8","json",r,null,function(a){F+=1;var b=document.createElement("div");b.id=a.Id,y=$(".EntryInWinner").html(),$(b).html(y),$(b).find(".userName").text(a.DisplayName);var c=document.createElement("img");c.src=a.Images[0].ImageUrls.FixedHeightThumbnail.Url,$(b).find(".entryImage").append(c),$(b).find(".entryTitle").text(a.Title);var d;d=null!==i&&i.Authenticated===!0&&i.PublicUserId.toLowerCase()===a.UserId.toLowerCase().replace(/\-/g,"")?$(".winnerPage").attr("data-currentuserredirect"):$(".winnerPage").attr("data-otheruserredirecturl")+"?puid="+a.UserId,$(b).find(".redirectOthers").attr("href",d);var e=v.indexOf(encodeURI(a.SystemTags[0]).replace("%7B","%7b").replace("%7D","%7d"));e>-1&&($(b).find(".contestName").text(decodeURI(w[e].replace(/\+/g," "))),$(b).find(".contestUrl").attr("href",decodeURIComponent(x[e])));var f="";"undefined"!=typeof z?(f=z+a.SystemTags[0]+"&a_id="+a.Id+"&sortEntry="+A,$(b).find(".entryUrl").attr("href",f),$(b).find(".Entries").attr("href",f),$(b).find(".entryTitle").attr("href",f)):($(".Entries").css("cursor","inherit"),$(".Entries").click(function(a){a.preventDefault()})),B.indexOf(a.Id.toLowerCase())>-1?($(b).find(".likeMe").html('<span class="icons likeMe" id="#btnLike-'+a.Id+'" style="background-position:-103px -60px; background-color:#00243F;"></span>'),$(b).find(".likeMe").attr("onclick","")):$(b).find(".likeMe").attr("onclick","LEGO.Site.Rebrick.API.likeContestEntry('"+a.Id+"','"+n+"','"+o+"',"+j+", 'true', this, '"+p+"')"),$("#winnerPageEntry").append(b),F>=l.length&&$("#winnerEntryLoadMore").hide()})}function e(){for(var a="[{'ContestSId': '"+v[0].replace("%7b","").replace("%7d","")+"'}",b=1;b<v.length;b++)a+=",{'ContestSId': '"+v[b].replace("%7b","").replace("%7d","")+"'}";a+="]";var c=t+u;s.executeServiceRequest(c,"POST",!0,"application/json; charset=utf-8","json",r,a,function(a){l=a;for(var b=0;b<l.length;b++)D.push(l[b].ContestSId),E.push(l[b].EntryId);for(var c=m>l.length?l.length:m,e=0;e<c;e++)d(l[e].EntryId)})}function f(a){var d=$("#globalBody").attr("data-serviceurl")+$("#globalBody").attr("data-serviceversion")+$("#globalBody").attr("data-methodname");d+=void 0!==i&&null!==i&&i.Authenticated===!0&&i.Age>j?H:I,
//finalUrl += queryParamModeratedAndNonModerated;
d+=encodeURI("{"+a+"}"),LEGO.Site.Rebrick.API.executeServiceRequest(d,"get",!1,"application/json; charset=utf-8","json",r,null,function(a){for(var d=0;d<a.Items.length;d++)b(E,a.Items[d])&&(G.push(a.Items[d]),c(a.Items[d],F<m))})}function g(){for(var a="[{'ContestSId': '"+v[0].replace("%7b","").replace("%7d","")+"'}",b=1;b<v.length;b++)a+=",{'ContestSId': '"+v[b].replace("%7b","").replace("%7d","")+"'}";a+="]";var c=t+u;s.executeServiceRequest(c,"POST",!0,"application/json; charset=utf-8","json",r,a,function(a){for(var b=0;b<a.length;b++)D.push(a[b].ContestSId),E.push(a[b].EntryId);q=D.unique(),l=a;for(var c=0;c<q.length;c++)f(q[c])})}function h(){window.LEGOIDReady.push(function(){LEGOID.API.getProfile().done(function(a){if("undefined"!=typeof a&&null!==a&&a.Authenticated){i=a,r=LEGOID.API.getSession().id;var b=encodeURI(new Date(JSON.parse(JSON.parse($("#globalBody").attr("data-oldestcontestdate")).replace("/Date(","").replace(")/",""))).toISOString()),c=encodeURI((new Date).toISOString()),d=$("#globalBody").attr("data-likeserviceurl")+$("#globalBody").attr("data-likeserviceversion")+"history.json?csrfToken="+r+"&filterKey=Rebrick&dateFrom="+b+"&dateTo="+c+"&userId%5B%5D="+a.PublicUserId+"&page=1&pageSize=500";LEGO.Site.Rebrick.API.executeServiceRequest(d,"get",!1,"application/json; charset=utf-8","json",null,null,function(b){if(null===B||B.length!==b.Items.length)for(var c=0;c<b.Items.length;c++)B.push(b.Items[c].ClientObjectId.toLowerCase());i=a,a.Age>j?e():g()})}else g(),i=null})})}var i,j,k,l,m,n,o,p,q,r=null,s=a.Site.Rebrick.API,t=$("#globalBody").attr("data-rebrickadminserviceurl"),u="ContestWinnerEntries/GetAll",v=[],w=[],x=[],y=null,z=null,A=!1,B=[],C=0,D=[],E=[],F=0,G=[],H="?Experiences%5B%5D=Rebrick&includePremoderated=false&sort=descending&PageSize=1000&systemtag%5B%5D=",I="?Experiences%5B%5D=Rebrick&includePremoderated=false&sort=descending&PageSize=1000&systemtag%5B%5D=";Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;c<b;c++){for(var d=c+1;d<b;d++)
// If this[i] is found later in the array
this[c]===this[d]&&(d=++c);a.push(this[c])}return a};var J=function(){for(var a=[],b=0,c=localStorage.length;b<c;b++){var d=localStorage.key(b);a.push(d)}for(var e=0,f=a.length;e<f;e++)/loadMoreContestPage/.test(a[e])&&localStorage.removeItem(a[e])};s.loadMoreWinnerEntries=function(){if(s.tracking.trackLoadMore(),void 0!==i&&null!==i&&i.Authenticated===!0&&i.Age>j){C+=1;for(var a=E.slice(m*C,m*(C+1)),b=0;b<a.length;b++)d(a[b])}else{var c=$(".winnerPage").find(".entryUrl:hidden").not("script").parent().parent().parent();if($(".winnerPage").find(".entryUrl:hidden").not("script").parent().parent().parent().length>0)for(var e=0;e<m;e++)c[e].style.display="block",$(".winnerPage").find(".entryUrl:hidden").not("script").parent().parent().parent().length<=0&&$("#winnerEntryLoadMore").hide();else $("#winnerEntryLoadMore").hide()}},$(function(){$("#mainDivWinnerPage").length>0&&(v=JSON.parse($("#globalBody").attr("data-allclosecontestids")),w=JSON.parse($("#globalBody").attr("data-allclosecontestnames")),x=JSON.parse($("#globalBody").attr("data-allclosecontesturls")),z=$(".winnerPage").attr("data-viewentryurl"),j=$(".winnerPage").attr("data-minoragelimit"),k=$(".winnerPage").attr("data-loadmoreentrycount"),n=$(".winnerPage").attr("data-experience"),o=$("#globalBody").attr("data-likeserviceurl")+$("#globalBody").attr("data-likeserviceversion"),p=$(".winnerPage").attr("data-likeunderageerrortext"),m=k,$("#spinner").modal("show"),h(),J(),$("#spinner").modal("hide"))})}(window.LEGO||{});